<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    var parameters = {
      poster: "<%= (@stream.live ? '/preview/' + @stream.user.username + '.jpg' : @stream.placeholder_url) %>",
      src: "http://<%= Settings.rtmp.server %>/hds/<%= @stream.user.username %>.f4m",
      plugin_ads: "/AdvertisementPlugin.swf",
      autoPlay: true,
      controlBarAutoHide: true,
      controlBarAutoHideTimeout: 1,
      playButtonOverlay: false,
      optimizeBuffering : false,
      optimizeInitialIndex: false,
      streamType: "live",
      liveBufferTime: 10,
      debug: true,
      bufferTime: 10,
      liveDynamicStreamingBufferTime: 10,
      volume: <%= settings(:player).volume %>,
      javascriptCallbackFunction: "createJSBridge",
    };
    if (swfobject.hasFlashPlayerVersion("10.1")) {
      swfobject.embedSWF(
        "/StrobeMediaPlayback.swf",
        "player",
        '100%',
        '100%',
        "10.1.0",
        "/expressInstall.swf",
        parameters,
        { allowFullScreen: "true", allowScriptAccess: 'always', wmode: 'opaque' },
        { name: "player" }
      );
    }
    else {
      $('#player').html('<video id="html5_player" src="//<%= Settings.rtmp.server %>/hls/<%= @stream.user.username %>/index.m3u8" controls="true"></video>');
    }
  });
  var player = null;
  function createJSBridge(id) {
    if (player == null) {
      player = document.getElementById(id);
    }
  }
</script>